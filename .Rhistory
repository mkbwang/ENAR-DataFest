box_3<-svyboxplot(DR1TSFAT~demo_race,design_no_diet,
xlab="Survey_year",ylab="Saturated Fat",
main="Changes of Saturated Fat between races",
col="lightblue")
#unsaturated fat
box_4<-svyboxplot(fatacid~demo_race,design_no_diet,
xlab="Survey_year",ylab="Unsaturated Fat",
main="Changes of Unsaturated Fat between races",
col="lightblue")
png("macronutrient_htn.png", width = 18, height = 12, units = 'in', res = 300)
par(mfrow=c(2,2))
#fiber
box_1<-svyboxplot(DR1TFIBE~htn_accaha,design_no_diet,
xlab="Survey_year",ylab="Fiber",
main="Changes of Fiber among people with hypertension",
col="lightblue")
#sugar
box_2<-svyboxplot(sugar~htn_accaha,design_no_diet,
xlab="Survey_year",ylab="Sugar",
main="Changes of Sugar among people with hypertension",
col="lightblue")
#saturated fat
box_3<-svyboxplot(DR1TSFAT~htn_accaha,design_no_diet,
xlab="Survey_year",ylab="Saturated Fat",
main="Changes of Saturated Fat among people with hypertension",
col="lightblue")
#unsaturated fat
box_4<-svyboxplot(fatacid~htn_accaha,design_no_diet,
xlab="Survey_year",ylab="Unsaturated Fat",
main="Changes of Unsaturated Fat among people with hypertension",
col="lightblue")
#fiber
fiber_htn<- svyglm(htn_accaha~demo_age_cut+demo_race+demo_gender+
svy_year*DR1TFIBE, design_no_diet, family = binomial)
#fiber
fiber_htn<- svyglm(htn_accaha_numeric~demo_age_cut+demo_race+demo_gender+
svy_year*DR1TFIBE, design_no_diet, family = binomial)
#fiber
fiber_htn<- svyglm(htn_accaha_numeric~demo_age_cut+demo_race+demo_gender+svy_year*DR1TFIBE, design_no_diet, family = binomial)
#fiber
fiber_htn<- svyglm(htn_accaha_numeric~demo_age_cat+demo_race+demo_gender+svy_year*DR1TFIBE, design_no_diet, family = binomial)
#fiber
fiber_htn<- svyglm(htn_accaha~demo_age_cat+demo_race+demo_gender+svy_year*DR1TFIBE, design_no_diet, family = binomial)
nhanes_no_diet <- nhanes_complete %>% filter(bp_med_use == "No" & DRQSDIET != 1 &
!is.na(DR1TKCAL) & !is.na(INDFMPIR))
nhanes_no_diet <- nhanes_no_diet[,  c("SEQN",
"svy_year",
"svy_weight_mec",
"svy_psu",
"svy_strata",
"svy_subpop_htn",
"svy_subpop_chol",
"DMDEDUC2",
"demo_age_cat",
"demo_age_years",
"demo_gender",
"demo_race",
"htn_accaha",
"DR1TFIBE",
"DR1TCARB",
"DR1TSFAT",
"DR1TMFAT",
"DR1TPFAT",
"DR1TALCO",
"cc_bmi",
"cc_diabetes")] %>% mutate(sugar = DR1TCARB-DR1TFIBE,
fatacid = DR1TMFAT+DR1TPFAT)
temp_vec <-nhanes_no_diet$htn_accaha %>% as.factor() %>% as.integer()
temp_vec <- temp_vec - 1
nhanes_no_diet$htn_accaha_numeric <- temp_vec %>% as.integer()
design_no_diet <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_no_diet,
nest = TRUE)
#fiber
fiber_htn<- svyglm(htn_accaha_numeric~demo_age_cat+demo_race+demo_gender+svy_year*DR1TFIBE, design_no_diet, family = binomial)
#fiber
fiber_htn<- svyglm(htn_accaha_numeric~demo_age_cat+demo_race+demo_gender+svy_year*DR1TFIBE, design_no_diet, family = binomial)
summary(fiber_htn)
#fiber
fiber_htn<- svyglm(htn_accaha_numeric~demo_age_cat+demo_race+demo_gender+svy_year*DR1TFIBE, design_no_diet, family = binomial)
summary(fiber_htn)
confint(fiber_htn)
#sugar
sugar_htn<-svyglm(htn_accaha_numeric~demo_age_cat+demo_race+demo_gender+svy_year*sugar, design_no_diet, family = binomial)
summary(sugar_htn)
confint(sugar_htn)
#saturated fat
satfat_htn <- svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*DR1TSFAT, design_no_diet, family = binomial)
summary(satfat_htn)
confint(satfat_htn)
#unsaturated fat
unsatfat_htn<-svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*fatacid, design_no_diet, family = binomial)
summary(unsatfat_htn)
confint(unsatfat_htn)
png("macronutrient_racess.png", width = 18, height = 12, units = 'in', res = 300)
par(mfrow=c(2,2))
#fiber
box_1<-svyboxplot(DR1TFIBE~demo_race,design_no_diet,
xlab="Race",ylab="Fiber",
main="Changes of Fiber between races",
col="lightblue")
#sugar
box_2<-svyboxplot(sugar~demo_race,design_no_diet,
xlab="Race",ylab="Sugar",
main="Changes of Sugar between races",
col="lightblue")
#saturated fat
box_3<-svyboxplot(DR1TSFAT~demo_race,design_no_diet,
xlab="Race",ylab="Saturated Fat",
main="Changes of Saturated Fat between races",
col="lightblue")
#unsaturated fat
box_4<-svyboxplot(fatacid~demo_race,design_no_diet,
xlab="Race",ylab="Unsaturated Fat",
main="Changes of Unsaturated Fat between races",
col="lightblue")
png("macronutrient_htn.png", width = 18, height = 12, units = 'in', res = 300)
par(mfrow=c(2,2))
#fiber
box_1<-svyboxplot(DR1TFIBE~htn_accaha,design_no_diet,
xlab="Hypertension",ylab="Fiber",
main="Changes of Fiber among people with hypertension",
col="lightblue")
#sugar
box_2<-svyboxplot(sugar~htn_accaha,design_no_diet,
xlab="Hypertension",ylab="Sugar",
main="Changes of Sugar among people with hypertension",
col="lightblue")
#saturated fat
box_3<-svyboxplot(DR1TSFAT~htn_accaha,design_no_diet,
xlab="Hypertension",ylab="Saturated Fat",
main="Changes of Saturated Fat among people with hypertension",
col="lightblue")
#unsaturated fat
box_4<-svyboxplot(fatacid~htn_accaha,design_no_diet,
xlab="Hypertension",ylab="Unsaturated Fat",
main="Changes of Unsaturated Fat among people with hypertension",
col="lightblue")
nhanes_selected <- nhanes_complete_selected_demo %>% select(-c("SEQN","svy_year","svy_weight_mec","svy_psu","svy_strata","svy_subpop_htn","svy_subpop_chol","htn_accaha_numeric"))
dim(nhanes_selected)
missing_data<-sapply(nhanes_selected,function(x) sum(is.na(x)/length(x)))
missing_data <- missing_data %>% as.data.frame() %>% mutate(name = rownames(.)) %>% arrange(desc(missing_data))
missing_data
nhanes_selected <- nhanes_complete_selected_demo %>% select(-c("SEQN","svy_year","svy_weight_mec","svy_psu","svy_strata","svy_subpop_htn","svy_subpop_chol","htn_accaha_numeric","DMDEDUC2"))
missing_data<-sapply(nhanes_selected,function(x) sum(is.na(x)/length(x)))
missing_data <- missing_data %>% as.data.frame() %>% mutate(name = rownames(.)) %>% arrange(desc(missing_data))
missing_data
nhanes_selected <- nhanes_complete_selected_demo %>% select(-c("SEQN","svy_year","svy_weight_mec","svy_psu","svy_strata","svy_subpop_htn","svy_subpop_chol","htn_accaha_numeric","DMDEDUC2"))
missing_data<-sapply(nhanes_selected,function(x) sum(is.na(x)/length(x)))
missing_data_df <- data.frame(
Variable = names(missing_data),
MissingPercentage = missing_data
)
ggplot(missing_data_df, aes(x = Variable, y = MissingPercentage)) +
geom_bar(stat = "identity") +
theme_minimal() +
labs(title = "Missing Ratio", x = "Demographic Variables", y = "Ratio of Missing") +
coord_flip()
table(nhanes_complete$svy_year) %>% hist()
table(nhanes_complete$svy_year) %>% as.data.frmae()
table(nhanes_complete$svy_year) %>% as.data.frame()
table(nhanes_complete$svy_year)
temp_table <- table(nhanes_complete$svy_year) %>% as.data.frame()
colnames(temp_table) <- c("year","count")
temp_data
temp_table
ggplot(temp_table,ars(x=year,y=count))+
geom_bar(stat="identity")+
labs(title="Number of observations in each year",x="Year",y="Count")+
theme_minimal()+
theme(plot.title = element_text(hjust = 0.5))
ggplot(temp_table,aes(x=year,y=count))+
geom_bar(stat="identity")+
labs(title="Number of observations in each year",x="Year",y="Count")+
theme_minimal()+
theme(plot.title = element_text(hjust = 0.5))
ggplot(temp_table,aes(x=year,y=count))+
geom_bar(stat="identity")+
labs(title="Number of observations in each survey year",x="Year",y="Count")+
theme_minimal()+
theme(plot.title = element_text(hjust = 0.5))
ggplot(temp_table, aes(x = year, y = count)) +
geom_bar(stat = "identity") +
theme_minimal() +
labs(title = "Year Distribution", x = "Year", y = "Count") +
coord_flip()
ggplot(temp_table, aes(x=year, y=count)) +
geom_bar(stat="identity") +
geom_text(aes(label=count), vjust=-0.3) +  # Add counts above bars
labs(title="Number of observations in each survey year", x="Year", y="Count") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
panel.grid.major = element_blank(),  # Remove major grid lines
panel.grid.minor = element_blank())
ggplot(temp_table, aes(x=year, y=count)) +
geom_bar(stat="identity") +
geom_text(aes(label=count), vjust=-0.3) +
labs(title="Number of observations in each survey year", x="Year", y="Count") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5,face="bold", size=14),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
ggplot(temp_table, aes(x=year, y=count)) +
geom_bar(stat="identity") +
geom_text(aes(label=count), vjust=-0.3) +
labs(title="Number of observations in each survey year", x="Year", y="Count") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5,face="bold", size=10),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary()
model %>% confint()
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary() %>% coef()
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary() %>% coef() [,c(1,5)]
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary() %>% coef() %>% (.)[,c(1,5)]
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary() %>% coef() %>% .[,c(1,5)]
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<- model %>% summary() %>% coef()
coef_[,c(1,5)]
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<- model %>% summary() %>% coef()
coef_[,c(1,4)]
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<- model %>% summary() %>% coef()
coef_[,c(4)]
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary() %>% coef() %>% round(.,4)
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary() %>% coef() %>% round(.,4) %>% kable()
library(knitr)
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary() %>% coef() %>% round(.,4) %>% kable()
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary() %>% coef() %>% round(.,4) %>% (.)[,4] %>% kable()
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary() %>% coef() %>% round(.,4) %>% (.)[,4]
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
rbind(coef_[,4],comfint(model))
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
rbind(coef_[,4],confint(model))
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
cbind(coef_[,4],confint(model)%>% as.data.frame() %>% round(.,4))
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
cbind(coef_[,4],confint(model)%>% as.data.frame() %>% round(.,4)) %>% kabel()
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
cbind(coef_[,4],confint(model)%>% as.data.frame() %>% round(.,4)) %>% kable()
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
cbind(coef_[,4],confint(model)%>% as.data.frame() %>% round(.,4)) %>% kable() %>% kable_styling()
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
glm_result<-cbind(coef_[,c(1,4)],confint(model)%>% as.data.frame() %>% round(.,4)) %>% kable()
colname(glm_result)<-c("Estimate","p value","2.5%","97.5%")
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
glm_result<-cbind(coef_[,c(1,4)],confint(model)%>% as.data.frame() %>% round(.,4)) %>% kable()
colnames(glm_result)<-c("Estimate","p value","2.5%","97.5%")
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
glm_result<-cbind(coef_[,c(1,4)],confint(model)%>% as.data.frame() %>% round(.,4)) %>% kable()
glm_result
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
glm_result<-cbind(coef_[,c(1,4)],confint(model)%>% as.data.frame() %>% round(.,4))
colnames(glm_result)<-c("Estimate","p value","2.5%","97.5%")
kable(glm_result,format = "markdown",digits = 4,caption = "GLM result"))
kable(glm_result,format = "markdown",digits = 4,caption = "GLM result")
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
coef_<-model %>% summary() %>% coef() %>% round(.,4)
glm_result<-cbind(coef_[,c(1,4)],confint(model)%>% as.data.frame() %>% round(.,4))
colnames(glm_result)<-c("Estimate","p value","2.5%","97.5%")
glm_result
#kable(glm_result,format = "markdown",digits = 4,caption = "GLM result")
model = svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+svy_year*cc_bmi+cc_diabetes,
design,
family=binomial)
model %>% summary()
# coef_<-model %>% summary() %>% coef() %>% round(.,4)
#
# glm_result<-cbind(coef_[,c(1,4)],confint(model)%>% as.data.frame() %>% round(.,4))
# colnames(glm_result)<-c("Estimate","p value","2.5%","97.5%")
#
# glm_result
#kable(glm_result,format = "markdown",digits = 4,caption = "GLM result")
nhanes_complete_selected_demo <- nhanes_complete[,c("SEQN",
"svy_year",
"svy_weight_mec",
"svy_psu",
"svy_strata",
"DMDEDUC2",
"svy_subpop_htn",
"svy_subpop_chol",
"DMDEDUC2",
"demo_age_cat",
"demo_age_years",
"demo_gender",
"demo_race",
"htn_accaha",
"cc_bmi",
"cc_diabetes")]
nhanes_complete_selected_demo$DMDEDUC2 %>% table()
aggr_plot <- aggr(nhanes_complete_selected_demo,
col=c('navyblue','yellow'),
numbers=TRUE, sortVars=TRUE,
labels=names(data), cex.axis=.7, gap=3,
ylab=c("Histogram of missing data","Pattern"))
nhanes_complete$DMDEDUC2 %>% is.na() %>% sum()
nhanes_complete$DMDEDUC2 %>% is.na() %>% sum() / length(.)
nhanes_complete$DMDEDUC2 %>% is.na() %>% mean()
nhanes_no_diet$DMDEDUC2 %>% is.na() %>% mean()
nhanes_no_diet$DMDEDUC2 %>% is.na() %>% sum()
aggr_plot <- aggr(nhanes_no_diet,
col=c('navyblue','yellow'),
numbers=TRUE, sortVars=TRUE,
labels=names(data), cex.axis=.7, gap=3,
ylab=c("Histogram of missing data","Pattern"))
# Race changes through survey years
race_table <- svytable(~demo_race+svy_year,design) %>% prop.table()
race_table <- race_table / apply(race_table,2,sum)
race_table_df <- as.data.frame(race_table)
race_year_p <- svychisq(~demo_race+svy_year,design)$p.value
race_histogram<-ggplot(race_table_df,aes(x=svy_year,y=Freq,fill=demo_race))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Race",title="Changes of Race through survey years", subtitle = paste0("Rao Scott test p value: ",round(race_year_p,4)))+
scale_fill_brewer(palette = "Set1") +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Gender changes through survey years, gender variable: demo_gender
gender_table <- svytable(~demo_gender+svy_year,design) %>% prop.table()
gender_table <- gender_table / apply(gender_table,2,sum)
gender_table_df <- as.data.frame(gender_table)
gender_year_p <- svychisq(~demo_gender+svy_year,design)$p.value
gender_histogram<-ggplot(gender_table_df,aes(x=svy_year,y=Freq,fill=demo_gender))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="gender",title="Changes of gender through survey years",
subtitle =paste0("Rao Scott test p value: ",round(gender_year_p,4)) )+
scale_fill_brewer(palette = "Dark2") +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Age changes through survey years, age variable: demo_age_cat
age_table <- svytable(~demo_age_cat+svy_year,design) %>% prop.table()
age_table <- age_table / apply(age_table,2,sum)
age_table_df <- as.data.frame(age_table)
age_year_p <- svychisq(~demo_age_cat+svy_year,design)$p.value
age_histogram<-ggplot(age_table_df,aes(x=svy_year,y=Freq,fill=demo_age_cat))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Age",title="Changes of Age through survey years",
subtitle=paste0("Rao Scott test p value: ",round(age_year_p,4)) )+
scale_fill_manual(values = c("pink", "green", "blue", "black")) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# BMI changes through survey years, BMI variable: cc_bmi
bmi_table <- svytable(~cc_bmi+svy_year,design) %>% prop.table()
bmi_table <- bmi_table / apply(bmi_table,2,sum)
bmi_table_df <- as.data.frame(bmi_table)
bmi_year_p <- svychisq(~cc_bmi+svy_year,design)$p.value
bmi_histogram<-ggplot(bmi_table_df,aes(x=svy_year,y=Freq,fill=cc_bmi))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="BMI",title="Changes of BMI through survey years",
subtitle = paste0("Rao Scott test p value: ",round(bmi_year_p,4)) )+
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Diabetes changes through survey years, Diabetes variable: cc_diabetes
diabetes_table <- svytable(~cc_diabetes+svy_year,design) %>% prop.table()
diabetes_table <- diabetes_table / apply(diabetes_table,2,sum)
diabetes_table_df <- as.data.frame(diabetes_table)
diabetes_year_p <- svychisq(~cc_diabetes+svy_year,design)$p.value
diabetes_histogram<-ggplot(diabetes_table_df,aes(x=svy_year,y=Freq,fill=cc_diabetes))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Diabetes",title="Changes of Diabetes through survey years",subtitle= paste0("Rao Scott test p value: ",round(diabetes_year_p,4)) )+
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
#library(patchwork)
combined_hist<-race_histogram+gender_histogram+
age_histogram+
plot_layout(ncol=1) +
theme(plot.title = element_text(size = 14),
legend.position = "bottom")
ggsave("combined_histograms.png", combined_hist, width = 16, height = 12)
# Race changes through survey years
race_table <- svytable(~demo_race+svy_year,design) %>% prop.table()
race_table <- race_table / apply(race_table,2,sum)
race_table_df <- as.data.frame(race_table)
race_year_p <- svychisq(~demo_race+svy_year,design)$p.value
race_histogram<-ggplot(race_table_df,aes(x=svy_year,y=Freq,fill=demo_race))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Race",title="Changes of Race through survey years", subtitle = paste0("Rao Scott test p value: ",round(race_year_p,4)))+
scale_fill_brewer(palette = "Set1") +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Gender changes through survey years, gender variable: demo_gender
gender_table <- svytable(~demo_gender+svy_year,design) %>% prop.table()
gender_table <- gender_table / apply(gender_table,2,sum)
gender_table_df <- as.data.frame(gender_table)
gender_year_p <- svychisq(~demo_gender+svy_year,design)$p.value
gender_histogram<-ggplot(gender_table_df,aes(x=svy_year,y=Freq,fill=demo_gender))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="gender",title="Changes of gender through survey years",
subtitle =paste0("Rao Scott test p value: ",round(gender_year_p,4)) )+
scale_fill_brewer(palette = "Dark2") +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Age changes through survey years, age variable: demo_age_cat
age_table <- svytable(~demo_age_cat+svy_year,design) %>% prop.table()
age_table <- age_table / apply(age_table,2,sum)
age_table_df <- as.data.frame(age_table)
age_year_p <- svychisq(~demo_age_cat+svy_year,design)$p.value
age_histogram<-ggplot(age_table_df,aes(x=svy_year,y=Freq,fill=demo_age_cat))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Age",title="Changes of Age through survey years",
subtitle=paste0("Rao Scott test p value: ",round(age_year_p,4)) )+
scale_fill_manual(values = c("pink", "green", "blue", "black")) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# BMI changes through survey years, BMI variable: cc_bmi
bmi_table <- svytable(~cc_bmi+svy_year,design) %>% prop.table()
bmi_table <- bmi_table / apply(bmi_table,2,sum)
bmi_table_df <- as.data.frame(bmi_table)
bmi_year_p <- svychisq(~cc_bmi+svy_year,design)$p.value
bmi_histogram<-ggplot(bmi_table_df,aes(x=svy_year,y=Freq,fill=cc_bmi))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="BMI",title="Changes of BMI through survey years",
subtitle = paste0("Rao Scott test p value: ",round(bmi_year_p,4)) )+
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Diabetes changes through survey years, Diabetes variable: cc_diabetes
diabetes_table <- svytable(~cc_diabetes+svy_year,design) %>% prop.table()
diabetes_table <- diabetes_table / apply(diabetes_table,2,sum)
diabetes_table_df <- as.data.frame(diabetes_table)
diabetes_year_p <- svychisq(~cc_diabetes+svy_year,design)$p.value
diabetes_histogram<-ggplot(diabetes_table_df,aes(x=svy_year,y=Freq,fill=cc_diabetes))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Diabetes",title="Changes of Diabetes through survey years",subtitle= paste0("Rao Scott test p value: ",round(diabetes_year_p,4)) )+
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
#library(patchwork)
combined_hist<-race_histogram+gender_histogram+
age_histogram+
plot_layout(ncol=1) +
theme(plot.title = element_text(size = 14),
legend.position = "bottom")
ggsave("combined_histograms.png", combined_hist, width = 8, height = 12)
