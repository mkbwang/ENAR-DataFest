# Diabetes changes through survey years, Diabetes variable: cc_diabetes
diabetes_table <- svytable(~cc_diabetes+svy_year,design) %>% prop.table()
diabetes_table <- diabetes_table / apply(diabetes_table,2,sum)
diabetes_table_df <- as.data.frame(diabetes_table)
diabetes_histogram<-ggplot(diabetes_table_df,aes(x=svy_year,y=Freq,fill=cc_diabetes))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Diabetes",title="Changes of Diabetes through survey years")+
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
#library(patchwork)
combined_hist<-race_histogram+gender_histogram+
age_histogram+bmi_histogram+diabetes_histogram+
plot_layout(ncol=2) +
theme(plot.title = element_text(size = 14),
legend.position = "bottom")
ggsave("combined_histograms.png", combined_hist, width = 16, height = 12)
# svybarplot(demo_race~svy_year,design,col = "skyblue", border = "darkblue")
# title("Race chages through the years")
# Race changes through survey years
race_table <- svytable(~demo_race+svy_year,design) %>% prop.table()
race_table <- race_table / apply(race_table,2,sum)
race_table_df <- as.data.frame(race_table)
race_histogram<-ggplot(race_table_df,aes(x=svy_year,y=Freq,fill=demo_race))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Race",title="Changes of Race through survey years")+
scale_fill_brewer(palette = "Set1") +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Gender changes through survey years, gender variable: demo_gender
gender_table <- svytable(~demo_gender+svy_year,design) %>% prop.table()
gender_table <- gender_table / apply(gender_table,2,sum)
gender_table_df <- as.data.frame(gender_table)
gender_histogram<-ggplot(gender_table_df,aes(x=svy_year,y=Freq,fill=demo_gender))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="gender",title="Changes of gender through survey years")+
scale_fill_brewer(palette = "Dark2") +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Age changes through survey years, age variable: demo_age_cat
age_table <- svytable(~demo_age_cat+svy_year,design) %>% prop.table()
age_table <- age_table / apply(age_table,2,sum)
age_table_df <- as.data.frame(age_table)
age_histogram<-ggplot(age_table_df,aes(x=svy_year,y=Freq,fill=demo_age_cat))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Age",title="Changes of Age through survey years")+
scale_fill_manual(values = c("pink", "green", "blue", "black")) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# BMI changes through survey years, BMI variable: cc_bmi
bmi_table <- svytable(~cc_bmi+svy_year,design) %>% prop.table()
bmi_table <- bmi_table / apply(bmi_table,2,sum)
bmi_table_df <- as.data.frame(bmi_table)
bmi_histogram<-ggplot(bmi_table_df,aes(x=svy_year,y=Freq,fill=cc_bmi))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="BMI",title="Changes of BMI through survey years")+
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Diabetes changes through survey years, Diabetes variable: cc_diabetes
diabetes_table <- svytable(~cc_diabetes+svy_year,design) %>% prop.table()
diabetes_table <- diabetes_table / apply(diabetes_table,2,sum)
diabetes_table_df <- as.data.frame(diabetes_table)
diabetes_histogram<-ggplot(diabetes_table_df,aes(x=svy_year,y=Freq,fill=cc_diabetes))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Diabetes",title="Changes of Diabetes through survey years")+
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
#library(patchwork)
combined_hist<-race_histogram+gender_histogram+
age_histogram+bmi_histogram+diabetes_histogram+
plot_layout(ncol=2) +
theme(plot.title = element_text(size = 14),
legend.position = "bottom")
ggsave("combined_histograms.png", combined_hist, width = 16, height = 12)
# svybarplot(demo_race~svy_year,design,col = "skyblue", border = "darkblue")
# title("Race chages through the years")
# Race changes through survey years
race_table <- svytable(~demo_race+svy_year,design) %>% prop.table()
race_table <- race_table / apply(race_table,2,sum)
race_table_df <- as.data.frame(race_table)
race_histogram<-ggplot(race_table_df,aes(x=svy_year,y=Freq,fill=demo_race))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Race",title="Changes of Race through survey years")+
scale_fill_brewer(palette = "Set1") +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Gender changes through survey years, gender variable: demo_gender
gender_table <- svytable(~demo_gender+svy_year,design) %>% prop.table()
gender_table <- gender_table / apply(gender_table,2,sum)
gender_table_df <- as.data.frame(gender_table)
gender_histogram<-ggplot(gender_table_df,aes(x=svy_year,y=Freq,fill=demo_gender))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="gender",title="Changes of gender through survey years")+
scale_fill_brewer(palette = "Dark2") +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Age changes through survey years, age variable: demo_age_cat
age_table <- svytable(~demo_age_cat+svy_year,design) %>% prop.table()
age_table <- age_table / apply(age_table,2,sum)
age_table_df <- as.data.frame(age_table)
age_histogram<-ggplot(age_table_df,aes(x=svy_year,y=Freq,fill=demo_age_cat))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Age",title="Changes of Age through survey years")+
scale_fill_manual(values = c("pink", "green", "blue", "black")) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# BMI changes through survey years, BMI variable: cc_bmi
bmi_table <- svytable(~cc_bmi+svy_year,design) %>% prop.table()
bmi_table <- bmi_table / apply(bmi_table,2,sum)
bmi_table_df <- as.data.frame(bmi_table)
bmi_histogram<-ggplot(bmi_table_df,aes(x=svy_year,y=Freq,fill=cc_bmi))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="BMI",title="Changes of BMI through survey years")+
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Diabetes changes through survey years, Diabetes variable: cc_diabetes
diabetes_table <- svytable(~cc_diabetes+svy_year,design) %>% prop.table()
diabetes_table <- diabetes_table / apply(diabetes_table,2,sum)
diabetes_table_df <- as.data.frame(diabetes_table)
diabetes_histogram<-ggplot(diabetes_table_df,aes(x=svy_year,y=Freq,fill=cc_diabetes))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Diabetes",title="Changes of Diabetes through survey years")+
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
# Hypertension changes through years, binary variable: htn_accaha
htn_table <- svytable(~htn_accaha+svy_year,design) %>% prop.table()
htn_table <- htn_table / apply(htn_table,2,sum)
htn_table_df <- as.data.frame(htn_table)
htn_histogram<-ggplot(htn_table_df,aes(x=svy_year,y=Freq,fill=htn_accaha))+
geom_bar(stat="identity",position=position_dodge())+
theme_minimal()+
labs(x="Survey_year",y="Frequency",fill="Hypertension",title="Changes of Hypertension through survey years")+
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5))
#library(patchwork)
combined_hist<-race_histogram+gender_histogram+
age_histogram+bmi_histogram+diabetes_histogram+htn_histogram+
plot_layout(ncol=2) +
theme(plot.title = element_text(size = 14),
legend.position = "bottom")
ggsave("combined_histograms.png", combined_hist, width = 16, height = 12)
temp_table <- svytable(~demo_race+svy_year,design)
temp_table
temp_table %>% chisq.test()
nhanes_complete_selected_demo[,c("demo_race","svy_year")] %>% table()
nhanes_complete_selected_demo[,c("demo_race","svy_year")] %>% table() %>% chisq.test()
nhanes_complete_selected_demo[,c("demo_gender","svy_year")] %>% table() %>% chisq.test()
svytable(~demo_gender+svy_year,design) %>% chisq.test()
nhanes_complete$svy_year
nhanes_complete$svy_year %>% table()
nhanes_complete$svy_year %>% table() %>% names()
year_vec <- nhanes_complete$svy_year %>% table() %>% names()
nhanes_complete_selected_2011 <- nhanes_complete %>% filter(svy_year == year_vec[1])
nhanes_complete_selected_2011 <- nhanes_complete %>% filter(svy_year == year_vec[1])
nhanes_complete_selected_2013 <- nhanes_complete %>% filter(svy_year == year_vec[2])
nhanes_complete_selected_2015 <- nhanes_complete %>% filter(svy_year == year_vec[3])
nhanes_complete_selected_2017 <- nhanes_complete %>% filter(svy_year == year_vec[4])
nhanes_complete_selected_2011 %>% dim()
View(nhanes_complete)
nhanes_complete_selected_2011 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[1])
nhanes_complete_selected_2013 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[2])
nhanes_complete_selected_2015 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[3])
nhanes_complete_selected_2017 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[4])
nhanes_complete_selected_2011 %>% dim()
design_2011 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2011,
nest = TRUE)
year_vec <- nhanes_complete$svy_year %>% table() %>% names()
nhanes_complete_selected_2011 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[1])
nhanes_complete_selected_2013 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[2])
nhanes_complete_selected_2015 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[3])
nhanes_complete_selected_2017 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[4])
design_2011 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2011,
nest = TRUE)
design_2013 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2013,
nest = TRUE)
design_2015 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2015,
nest = TRUE)
design_2017 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2017,
nest = TRUE)
svytable(~demo_race,design_2011)
svytable(~demo_race,design)
svytable(~demo_race+svy_year,design)
svytable(~demo_race+svy_year,design) %>% kruskal.test()
svytable(~demo_race+svy_year,design) %>% kruskal.test(demo_race~svy_eat,.)
svytable(~demo_race+svy_year,design) %>% kruskal.test(demo_race~svy_year,.)
svytable(~demo_race+svy_year,design) %>% prop.table() %>% chisq.test()
race_table_df
race_table
race_table %>% chisq.test()
htn_table %>% chisq.test()
htn_age <-svytable(~htn_accaha+demo_age_cat,degisn) %>% prop.table()
htn_age <-svytable(~htn_accaha+demo_age_cat,design) %>% prop.table()
htn_age <- htn_age / apply(htn_age,2,sum)
htn_age
htn_age %>% chisq.test()
htn_age <-svytable(~htn_accaha+demo_age_cat,design) %>% prop.table()
htn_age
htn_age / apply(htn_age,2,sum)
apply(htn_age,2,sum)
apply(htn_age,1 , function(x) { x/apply(htn_age,2,sum)})
apply(htn_age,1 , function(x) { x/apply(htn_age,2,sum)}) %>% t()
apply(htn_age,1 , function(x) { x/apply(htn_age,2,sum)}) %>% t() %>% chisq.test()
htn_age
htn_age /apply(htn_age,2,sum) %>% chisq.test()
(htn_age /apply(htn_age,2,sum) ) %>% chisq.test()
apply(htn_age,1 , function(x) { x/apply(htn_age,2,sum)}) %>% t() %>% kruskal.test(hen_accaha~demo_age_cat,.)
apply(htn_age,1 , function(x) { x/apply(htn_age,2,sum)}) %>% t() %>% kruskal.test(htn_accaha~demo_age_cat,.)
apply(htn_age,1 , function(x) { x/apply(htn_age,2,sum)}) %>% t() %>% kruskal.test(htn_accaha~demo_age_cat,.)
apply(htn_age,1 , function(x) { x/apply(htn_age,2,sum)}) %>% t()
apply(htn_age,1 , function(x) { x/apply(htn_age,2,sum)}) %>% t() %>% kruskal.test(htn_accaha~demo_age_cat,.)
apply(htn_age,1 , function(x) { x/apply(htn_age,2,sum)}) %>% kruskal.test(htn_accaha~demo_age_cat,.)
svytable(~demo_race+svy_year,design) %>% chisq.test()
svytable(~demo_age_cat+svy_year,design) %>% chisq.test()
svytable(~demo_gender+svy_year,design) %>% chisq.test()
svytable(~cc_bmi+svy_year,design) %>% chisq.test()
svytable(~demo_race+svy_year,design) %>% fisher.test()
nhanes_complete_selected_2011 <- nhanes_compelte_selected_demo %>% filter(svy_year == 2011)
nhanes_complete_selected_2011 <- nhanes_compelte_selected_demo %>% filter(svy_year == year_vec[1])
nhanes_complete_selected_2011 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[1])
nhanes_complete_selected_2011 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[1])
nhanes_complete_selected_2013 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[2])
nhanes_complete_selected_2015 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[3])
nhanes_complete_selected_2017 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[4])
design_2011 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2011,
nest = TRUE)
svyglm(htn_accaha~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary()
svyglm(htn_accaha~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial)
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial)
nhanes_complete_selected_demo$htn_accaha_numeric <-nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.numeric() - 1
nhanes_complete_selected_2011 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[1])
nhanes_complete_selected_2013 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[2])
nhanes_complete_selected_2015 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[3])
nhanes_complete_selected_2017 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[4])
design_2011 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2011,
nest = TRUE)
design_2013 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2013,
nest = TRUE)
design_2015 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2015,
nest = TRUE)
design_2017 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2017,
nest = TRUE)
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial)
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2013,family=binomial) %>% summary() %>% coef() %>% data.frame()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
# svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2013,family=binomial) %>% summary() %>% coef() %>% data.frame()
nhanes_complete_selected_2011$htn_accaha_numeric %>% table()
nhanes_complete_selected_2011$htn_accaha_numeric %>% typeof()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
# svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2013,family=binomial) %>% summary() %>% coef() %>% data.frame()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
nhanes_complete_selected_2011$htn_accaha_numeric %>% as.integger() %>% table()
nhanes_complete_selected_2011$htn_accaha_numeric %>% as.integer() %>% table()
nhanes_complete_selected_2011$htn_accaha_numeric %>% as.integer() %>% typeof()
nhanes_complete_selected_demo$htn_accaha_numeric <-nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.numeric() - 1 %>% as.integer()
year_vec <- nhanes_complete$svy_year %>% table() %>% names()
nhanes_complete_selected_2011 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[1])
nhanes_complete_selected_2013 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[2])
nhanes_complete_selected_2015 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[3])
nhanes_complete_selected_2017 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[4])
design_2011 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2011,
nest = TRUE)
design_2013 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2013,
nest = TRUE)
design_2015 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2015,
nest = TRUE)
design_2017 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2017,
nest = TRUE)
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
# svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2013,family=binomial) %>% summary() %>% coef() %>% data.frame()
nhanes_complete_selected_2011$htn_accaha_numeric %>% typeof()
nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.numeric() - 1 %>% as.integer() %>% typeof()
nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.numeric() - 1 %>% as.integer() %>% table()
nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.numeric() - 1  %>% table()
nhanes_complete_selected_demo$htn_accaha %>% as.numeric() %>% table()
nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% table()
nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.integer() %>% table()
nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.integer() -1 %>% table()
temp_vec<-nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.integer()
typeof(temp_vec)
table(temp_vec)
table(temp_vec-1)
temp_vec <-nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.integer()
nhanes_complete_selected_demo$htn_accaha_numeric <- temp_vec - 1
nhanes_complete_selected_demo$htn_accaha_numeric%>% typeof()
temp_vec <-nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.integer()
nhanes_complete_selected_demo$htn_accaha_numeric <- temp_vec - 1
typeof(temp_vec)
typeof(temp_vec-1)
temp_vec-1 %>% as.integer() %>% table()
temp_vec-1 %>% as.integer() %>% dim()
temp_vec-1 %>% typeof()
temp_vec - 1 %>% typeof()
temp_vec <- temp_vec - 1
table(temp_vec)
temp_vec %>% as.integer() %>% table()
temp_vec %>% as.integer() %>% typeof()
temp_vec <-nhanes_complete_selected_demo$htn_accaha %>% as.factor() %>% as.integer()
temp_vec <- temp_vec - 1
nhanes_complete_selected_demo$htn_accaha_numeric <- temp_vec %>% as.integer()
year_vec <- nhanes_complete$svy_year %>% table() %>% names()
nhanes_complete_selected_2011 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[1])
nhanes_complete_selected_2013 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[2])
nhanes_complete_selected_2015 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[3])
nhanes_complete_selected_2017 <- nhanes_complete_selected_demo %>% filter(svy_year == year_vec[4])
design_2011 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2011,
nest = TRUE)
design_2013 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2013,
nest = TRUE)
design_2015 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2015,
nest = TRUE)
design_2017 <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_2017,
nest = TRUE)
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
# svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2013,family=binomial) %>% summary() %>% coef() %>% data.frame()
nhanes_complete_selected_demo$htn_accaha_numeric %>% typeof()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2013,family=binomial) %>% summary() %>% coef() %>% data.frame()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes+svy_year*(demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes),design,family=binomial) %>% summary() %>% coef() %>% data.frame()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes+svy_year*demo_age_cat,design,family=binomial) %>% summary() %>% coef() %>% data.frame()
design <- svydesign(ids = ~svy_psu,
strata = ~svy_strata,
weights = ~svy_weight_mec,
data = nhanes_complete_selected_demo,
nest = TRUE)
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes+svy_year*demo_age_cat,design,family=binomial) %>% summary() %>% coef() %>% data.frame()
# svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
#
#
# svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2013,family=binomial) %>% summary() %>% coef() %>% data.frame()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes+svy_year*demo_age_cat,design,family=binomial) %>% summary()
svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes+svy_year*(demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes),design,family=binomial) %>% summary()
svyglm(htn_accaha_numeric~svy_year*(demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes),design,family=binomial) %>% summary()
svyglm(htn_accaha_numeric~svy_year*(demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes),design,family=binomial) %>% summary()
svyglm(htn_accaha_numeric~svy_year*(demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes),design,family=binomial) %>% summary() %>% confint()
# svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
#
#
# svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2013,family=binomial) %>% summary() %>% coef() %>% data.frame()
model = svyglm(htn_accaha_numeric~svy_year*(demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes),design,family=binomial)
model %>% summary()
# svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2011,family=binomial) %>% summary() %>% coef() %>% data.frame()
#
#
# svyglm(htn_accaha_numeric~demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes,design_2013,family=binomial) %>% summary() %>% coef() %>% data.frame()
model = svyglm(htn_accaha_numeric~svy_year*(demo_age_cat+demo_gender+demo_race+cc_bmi+cc_diabetes),design,family=binomial)
model %>% summary()
model %>% confint()
library(pROC)
predictions<-predict(model, type = "response")
sum(nhanes_complete_selected_demo$htn_accaha_numeric)
mean(nhanes_complete_selected_demo$htn_accaha_numeric)
p=mean(nhanes_complete_selected_demo$htn_accaha_numeric)
AIC(model)
BIC(model)
predictions<-predict(model, type = "response")
p=mean(nhanes_complete_selected_demo$htn_accaha_numeric)
predicted_class <- ifelse(predictions > p, 1, 0)
sensitivity_value <- mean(predicted_class[nhanes_complete_selected_demo$htn_accaha_numeric==1])
specificity_value <- mean(predicted_class[nhanes_complete_selected_demo$htn_accaha_numeric==0])
sensitivity_value
specificity_value
mean(predicted_class[nhanes_complete_selected_demo$htn_accaha_numeric==1])
P
p
ifelse(predictions > p, 1, 0)
ifelse(predictions > p, 1, 0) %>% table()
predictions<-predict(model, type = "response")
p=mean(nhanes_complete_selected_demo$htn_accaha_numeric)
predicted_class <- ifelse(predictions > p, 1, 0)
nhanes_complete_selected_demo$htn_accaha_numeric==1 %>% table()
actual = nhanes_complete_selected_demo$htn_accaha_numeric
actual %>% table()
predicted_class %>% table()
conf_matrix <- table(Predicted = predicted_class, Actual = actual)
actual = nhanes_complete_selected_demo$htn_accaha_numeric
conf_matrix <- table(Predicted = predicted_class, Actual = actual)
actua; %>% dim()
actual %>% dim()
actual %>% length()
actual %>% unlist()
actual %>% unlist() %>% table()
actual = nhanes_complete_selected_demo$htn_accaha_numeric %>% unlist()
conf_matrix <- table(Predicted = predicted_class, Actual = actual)
predicted_class <- ifelse(predictions > p, 1, 0) %>% unlist()
conf_matrix <- table(Predicted = predicted_class, Actual = actual)
length(predicted_class)
length(actual)
nhanes_complete_selected_demo %>% is.na() %>% summary()
26239-715
actual = nhanes_complete_selected_demo %>% na.omit() %>% select(htn_accaha_numeric)
actual = na.omit(nhanes_complete_selected_demo) %>% select(htn_accaha_numeric)
actual = na.omit(nhanes_complete_selected_demo)$htn_accaha_numeric
conf_matrix <- table(Predicted = predicted_class, Actual = actual)
actual %>% length()
nhanes_complete_selected_demo$htn_accaha_numeric [nhanes_complete_selected_demo$cc_bmi %>% is.na() %>% `!`()]
actual = nhanes_complete_selected_demo$htn_accaha_numeric [nhanes_complete_selected_demo$cc_bmi %>% is.na() %>% `!`()]
conf_matrix <- table(Predicted = predicted_class, Actual = actual)
sensitivity(conf_matrix)
sensitivity_value <- conf_matrix[2,2]/(conf_matrix[2,2]+conf_matrix[2,1])
specificity_value <- conf_matrix[1,1]/(conf_matrix[1,1]+conf_matrix[1,2])
sensitivity_value
specificity_value
actual = nhanes_complete_selected_demo$htn_accaha_numeric [nhanes_complete_selected_demo$cc_bmi %>% is.na() %>% `!`()]
conf_matrix <- table(Predicted = predicted_class, Actual = actual)
sensitivity_value <- conf_matrix[2,2]/(conf_matrix[2,2]+conf_matrix[2,1])
specificity_value <- conf_matrix[1,1]/(conf_matrix[1,1]+conf_matrix[1,2])
accuracy_value <- (conf_matrix[1,1]+conf_matrix[2,2])/(conf_matrix[1,1]+conf_matrix[1,2]+conf_matrix[2,1]+conf_matrix[2,2])
sensitivity_value
specificity_value
accuracy_value
actual = nhanes_complete_selected_demo$htn_accaha_numeric [nhanes_complete_selected_demo$cc_bmi %>% is.na() %>% `!`()]
conf_matrix <- table(Predicted = predicted_class, Actual = actual)
sensitivity_value <- conf_matrix[2,2]/(conf_matrix[2,2]+conf_matrix[2,1])
specificity_value <- conf_matrix[1,1]/(conf_matrix[1,1]+conf_matrix[1,2])
accuracy_value <- (conf_matrix[1,1]+conf_matrix[2,2])/(conf_matrix[1,1]+conf_matrix[1,2]+conf_matrix[2,1]+conf_matrix[2,2])
F1_score <- 2*sensitivity_value*specificity_value/(sensitivity_value+specificity_value)
sensitivity_value
specificity_value
accuracy_value
F1_score
roc_obj <- roc(actual, predictions)
plot(roc_obj, print.thres = "best", print.thres.best.method = "closest.topleft")
auc(roc_obj)
data.frame(sensitivity = sensitivity_value,
specificity = specificity_value,
accuracy = accuracy_value,
F1_score = F1_score)
# some model diagnosis
predictions<-predict(model, type = "response")
p=mean(nhanes_complete_selected_demo$htn_accaha_numeric)
predicted_class <- ifelse(predictions > p, 1, 0) %>% unlist()
actual = nhanes_complete_selected_demo$htn_accaha_numeric [nhanes_complete_selected_demo$cc_bmi %>% is.na() %>% `!`()]
conf_matrix <- table(Predicted = predicted_class, Actual = actual)
sensitivity_value <- conf_matrix[2,2]/(conf_matrix[2,2]+conf_matrix[2,1])
specificity_value <- conf_matrix[1,1]/(conf_matrix[1,1]+conf_matrix[1,2])
accuracy_value <- (conf_matrix[1,1]+conf_matrix[2,2])/(conf_matrix[1,1]+conf_matrix[1,2]+conf_matrix[2,1]+conf_matrix[2,2])
F1_score <- 2*sensitivity_value*specificity_value/(sensitivity_value+specificity_value)
data.frame(sensitivity = sensitivity_value,
specificity = specificity_value,
accuracy = accuracy_value,
F1_score = F1_score)
roc_obj <- roc(actual, predictions)
plot(roc_obj, print.thres = "best", print.thres.best.method = "closest.topleft")
auc(roc_obj)
